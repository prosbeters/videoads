<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Prompt Generator (Dual Prompt)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #f3f4f6;
        }
        .form-input, .form-select, .form-file {
            background-color: #1f2937;
            border-color: #4b5563;
            color: #f3f4f6;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            background-color: #374151;
            border-color: #3b82f6;
            box-shadow: none;
            outline: none;
        }
        .btn-primary {
            background-color: #2563eb;
            transition: background-color 0.3s;
            position: relative;
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        .btn-primary:disabled {
            background-color: #4b5563;
            cursor: not-allowed;
        }
        .btn-secondary {
            background-color: #4b5563;
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #6b7280;
        }
        .output-container {
            border: 1px solid #374151;
            background-color: #1f2937;
        }
        #image-loader div, .btn-loader {
            border-top-color: #3b82f6;
        }
        .btn-loader {
            width: 20px;
            height: 20px;
            border: 3px solid #f3f4f6;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .ratio-label {
            cursor: pointer;
            border: 2px solid #4b5563;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        .ratio-label:hover {
             border-color: #6b7280;
        }
        input[type="radio"]:checked + .ratio-label {
            border-color: #2563eb;
            background-color: #2563eb20;
            color: #60a5fa;
        }
        /* Modal Styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-container {
            transition: transform 0.3s ease;
        }
        #help-modal-content ol {
            list-style-type: decimal;
            margin-left: 1.5rem;
        }
        #help-modal-content li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Login Container -->
    <div id="login-container" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md">
            <h1 class="text-5xl font-bold text-white text-center mb-8">Video Prompt Generator</h1>
            <div class="bg-gray-800 p-8 rounded-xl shadow-lg">
                <div class="flex justify-center mb-6">
                    <svg class="w-16 h-16 text-blue-500" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16.88 18.15C16.24 18.68 15.5 19.08 14.68 19.31C13.86 19.54 13.01 19.65 12.13 19.65C10.09 19.65 8.31 19.01 6.79 17.73C5.27 16.45 4.5 14.73 4.5 12.57C4.5 11.43 4.73 10.38 5.19 9.42C5.65 8.46 6.3 7.65 7.14 7.01C7.98 6.37 8.94 5.91 10.03 5.64C11.12 5.37 12.25 5.24 13.43 5.24C14.57 5.24 15.61 5.41 16.55 5.75L15.98 7.68C15.21 7.4 14.38 7.26 13.48 7.26C12.54 7.26 11.67 7.39 10.86 7.65C10.05 7.91 9.35 8.29 8.76 8.79C8.17 9.29 7.72 9.9 7.41 10.62C7.1 11.34 6.95 12.1 6.95 12.9C6.95 14.48 7.47 15.76 8.51 16.74C9.55 17.72 10.85 18.21 12.4 18.21C13.21 18.21 13.95 18.09 14.62 17.85L15.23 19.74L16.88 18.15Z" fill="currentColor"/>
                        <path d="M19.5 12.57C19.5 10.41 18.73 8.69 17.21 7.41C15.69 6.13 13.91 5.49 11.87 5.49C10.73 5.49 9.68 5.72 8.72 6.18C8.25 6.42 7.82 6.71 7.41 7.01L9.06 8.64C9.62 8.16 10.25 7.84 10.95 7.68C11.65 7.52 12.37 7.44 13.13 7.44C14.71 7.44 15.99 7.96 16.97 9C17.95 10.04 18.44 11.33 18.44 12.87C18.44 13.68 18.32 14.42 18.08 15.09L19.97 15.7L19.5 12.57Z" fill="currentColor" fill-opacity="0.6"/>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold text-white text-center mb-2">Selamat Datang</h2>
                <p class="text-gray-400 text-center mb-6">Silakan login untuk melanjutkan.</p>
                <form id="login-form">
                    <div class="space-y-4">
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-300 mb-1">Email</label>
                            <input type="email" id="email" class="w-full form-input rounded-md" required>
                        </div>
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Password</label>
                            <input type="password" id="password" class="w-full form-input rounded-md" required>
                        </div>
                    </div>
                    <div id="login-error" class="text-red-400 text-sm mt-4 text-center"></div>
                    <div class="mt-6">
                        <button type="submit" class="btn-primary w-full font-bold py-3 rounded-lg flex items-center justify-center">
                            <span id="login-btn-text">Login</span>
                            <span id="login-btn-loader" class="hidden btn-loader"></span>
                        </button>
                    </div>
                </form>
            </div>
            <p class="text-center mt-8 font-bold text-white">Made by ProsBe</p>
        </div>
    </div>

    <!-- Main App Container (hidden by default) -->
    <div id="app-container" class="hidden">
        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <!-- API Key Notice -->
            <div id="api-key-notice" class="hidden bg-yellow-500/10 border border-yellow-500/30 text-yellow-300 px-4 py-3 rounded-lg relative mb-6" role="alert">
                <strong class="font-bold">Perhatian!</strong>
                <span class="block sm:inline">Anda belum memasukkan API Key Google AI Studio. Silakan masukkan di menu Pengaturan untuk menggunakan fitur AI.</span>
                <button id="open-settings-from-notice" class="ml-4 bg-yellow-500 text-black font-bold py-1 px-3 rounded-md">Buka Pengaturan</button>
            </div>

            <header class="flex justify-between items-center mb-8">
                <div class="text-left">
                    <h1 class="text-4xl font-bold text-white mb-2">Video Prompt Generator</h1>
                    <p class="text-lg text-gray-400">Ciptakan prompt video sinematik dengan kekuatan AI.</p>
                </div>
                <div class="flex items-center gap-2">
                     <button id="open-help-button" class="p-2 rounded-full hover:bg-gray-700 transition-colors">
                         <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    </button>
                    <button id="open-settings-button" class="p-2 rounded-full hover:bg-gray-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                    <button id="logout-button" class="p-2 rounded-full hover:bg-gray-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    </button>
                </div>
            </header>

            <main>
                <div id="form-container" class="bg-gray-800 p-6 rounded-xl shadow-lg">
                    <!-- Image Analysis Section -->
                    <div class="mb-8 bg-gray-900 p-4 rounded-lg border border-blue-500/30">
                        <label for="image-upload" class="block text-xl font-semibold text-white mb-2">Mulai dengan Gambar (Opsional)</label>
                        <p class="text-gray-400 mb-3">Unggah gambar produk Anda (gedung, makanan, dll.) dan biarkan AI menganalisis & mengisi formulir secara otomatis.</p>
                        <div class="flex flex-col sm:flex-row gap-2 items-center">
                            <input type="file" id="image-upload" accept="image/*" class="w-full form-file rounded-md file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-gray-300 hover:file:bg-gray-600">
                            <button type="button" id="analyze-image-button" class="btn-secondary font-bold py-2 px-5 rounded-lg text-white w-full sm:w-auto flex items-center justify-center mt-2 sm:mt-0">
                                <span id="analyze-btn-text">Analisa Gambar</span>
                                <span id="analyze-btn-loader" class="hidden btn-loader"></span>
                            </button>
                        </div>
                        <div id="image-preview-container" class="mt-4 text-center hidden">
                            <img id="image-preview" src="#" alt="Pratinjau Gambar" class="max-h-48 mx-auto rounded-lg">
                        </div>
                        <div id="analysis-result" class="text-green-400 mt-3 text-center font-semibold"></div>
                    </div>

                    <form id="product-form">
                        <!-- Style & Ratio Selector -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label for="animation-style" class="block text-xl font-semibold text-white mb-2">Pilih Gaya Iklan Produk</label>
                                <select id="animation-style" class="w-full form-select rounded-md">
                                    <option value="transformasi">1. Transformasi Kapsul Ajaib</option>
                                    <option value="perakitan">2. Perakitan Dinamis</option>
                                    <option value="logo">3. Transformasi Logo</option>
                                    <option value="dekonstruksi">4. Dekonstruksi Logo (Mewah)</option>
                                    <option value="ruangan">5. Perakitan Ruangan</option>
                                    <option value="ledakan">6. Ledakan Kreatif</option>
                                    <option value="suasana">7. Suasana dalam Kotak</option>
                                    <option value="kejutan">8. Kejutan dari Kotak</option>
                                    <option value="layar">9. Keluar dari Layar</option>
                                    <option value="unboxing">10. Unboxing Elegan</option>
                                    <option value="vault">11. Transformasi Ruang Kolektor</option>
                                    <option value="pov">12. Aksi Sudut Pandang Pertama (POV)</option>
                                    <option value="pemujaan">13. Pemujaan Produk (Sakral)</option>
                                    <option value="fashion">14. Pembekuan Realitas (Gaya Fashion)</option>
                                    <option value="sajian">15. Sajian Sinematik (Makanan)</option>
                                    <option value="teardown">16. Pembongkaran Canggih (Tech)</option>
                                    <option value="kinetic">17. Disintegrasi Kinetik</option>
                                    <option value="absurd">18. Kekacauan Absurd Robot Mini</option>
                                    <option value="ingredient_explosion">19. Ledakan Bahan Baku</option>
                                    <option value="magical_transformation">20. Transformasi Lingkungan Sekitar</option>
                                    <option value="retro_dynamic">21. Gaya Retro Dinamis</option>
                                    <option value="harta-karun">22. Pembukaan Harta Karun</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xl font-semibold text-white mb-2">Pilih Rasio Video</label>
                                <div class="flex gap-4">
                                    <input type="radio" name="aspect_ratio" id="ratio_16_9" value="16:9" class="sr-only" checked>
                                    <label for="ratio_16_9" class="ratio-label w-full text-center">Landscape (16:9)</label>
                                    
                                    <input type="radio" name="aspect_ratio" id="ratio_9_16" value="9:16" class="sr-only">
                                    <label for="ratio_9_16" class="ratio-label w-full text-center">Portrait (9:16)</label>
                                </div>
                            </div>
                        </div>

                        <!-- Shared Inputs -->
                        <div>
                            <h3 class="text-xl font-semibold mb-4 text-white border-b border-gray-600 pb-2">Detail Produk & Suasana</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="product-name" class="block text-sm font-medium text-gray-300 mb-1">Nama Produk / Merek / Pesan</label>
                                    <input type="text" id="product-name" class="w-full form-input rounded-md" placeholder="Contoh: Kacamata 'Aura'" required>
                                </div>
                                <div id="location-wrapper">
                                    <label for="location" class="block text-sm font-medium text-gray-300 mb-1">Lokasi / Latar Awal</label>
                                    <input type="text" id="location" class="w-full form-input rounded-md" placeholder="Contoh: Jalanan kota yang ramai saat senja" required>
                                </div>
                                <div class="md:col-span-2">
                                    <label for="product-features" class="block text-sm font-medium text-gray-300 mb-1">Fitur / Keunggulan / Rasa / Mood</label>
                                    <textarea id="product-features" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: high fashion, modern noir, mewah, misterius, berani"></textarea>
                                </div>
                                <!-- Style-specific inputs -->
                                 <div id="perakitan-inputs" class="md:col-span-2 hidden">
                                     <label for="product-components" class="block text-sm font-medium text-gray-300 mb-1">Komponen / Bahan Utama Produk</label>
                                     <textarea id="product-components" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Serat karbon, busa nitrogen, kain rajut"></textarea>
                                 </div>
                                 <div id="logo-inputs" class="md:col-span-2 hidden">
                                     <label for="logo-description" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Logo Merek Anda</label>
                                     <input type="text" id="logo-description" class="w-full form-input rounded-md" placeholder="Contoh: Logo centang yang dinamis">
                                     <label for="final-element" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Elemen Terkait di Akhir (Opsional)</label>
                                     <input type="text" id="final-element" class="w-full form-input rounded-md" placeholder="Contoh: Sebuah bola basket mendarat di sebelah sepatu">
                                 </div>
                                <div id="dekonstruksi-inputs" class="md:col-span-2 hidden">
                                     <label for="dekon-logo-text" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Logo & Teks Awal</label>
                                     <input type="text" id="dekon-logo-text" class="w-full form-input rounded-md" placeholder="Contoh: Logo mahkota emas Rolex">
                                     <label for="dekon-components" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Komponen Mekanis Hasil Dekonstruksi</label>
                                     <textarea id="dekon-components" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: gigi mesin, bezel, per, casing, dan potongan dial"></textarea>
                                 </div>
                                <div id="ruangan-inputs" class="md:col-span-2 hidden">
                                     <label for="product-collection" class="block text-sm font-medium text-gray-300 mb-1">Koleksi Produk dalam Adegan</label>
                                     <textarea id="product-collection" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: tempat tidur, meja samping, lampu, lemari, rak, cermin, karpet, gorden"></textarea>
                                     <label for="final-human-element" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Elemen Manusia di Akhir (Opsional)</label>
                                     <input type="text" id="final-human-element" class="w-full form-input rounded-md" placeholder="Contoh: Seorang desainer interior yang tersenyum puas">
                                 </div>
                                 <div id="ledakan-inputs" class="md:col-span-2 hidden">
                                     <label for="ledakan-collection" class="block text-sm font-medium text-gray-300 mb-1">Koleksi Produk yang Meledak Keluar</label>
                                     <textarea id="ledakan-collection" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: sofa modern, bantal warna-warni, kursi kuning, lampu, rak buku, gitar, dekorasi unik"></textarea>
                                     <label for="human-reaction" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Deskripsi Orang & Reaksinya</label>
                                     <input type="text" id="human-reaction" class="w-full form-input rounded-md" placeholder="Contoh: Seorang wanita muda cantik dengan sweater merah, kaget dan takjub">
                                 </div>
                                 <div id="suasana-inputs" class="md:col-span-2 hidden">
                                     <label for="vibe-description" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Suasana / Adegan</label>
                                     <textarea id="vibe-description" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Pesta kebun sore hari yang santai, sesi nge-band di tepi pantai, malam nonton film yang nyaman"></textarea>
                                     <label for="vibe-elements" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Orang & Elemen Kunci dalam Adegan</label>
                                     <input type="text" id="vibe-elements" class="w-full form-input rounded-md" placeholder="Contoh: Empat teman bermain gitar, keyboard. Ada furnitur rotan, minuman dingin, lampu-lampu.">
                                 </div>
                                <div id="kejutan-inputs" class="md:col-span-2 hidden">
                                     <label for="surprise-recipient" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Penerima Kejutan</label>
                                     <input type="text" id="surprise-recipient" class="w-full form-input rounded-md" placeholder="Contoh: Seorang wanita yang sedang duduk termenung di sofa">
                                     <label for="surprise-element" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Apa/Siapa yang Keluar dari Kotak?</label>
                                     <input type="text" id="surprise-element" class="w-full form-input rounded-md" placeholder="Contoh: Seorang pria tampan membawa setangkai mawar merah">
                                 </div>
                                <div id="layar-inputs" class="md:col-span-2 hidden">
                                     <label for="screen-product" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Produk di Layar Gawai</label>
                                     <input type="text" id="screen-product" class="w-full form-input rounded-md" placeholder="Contoh: Burger yang lezat dengan keju meleleh di aplikasi">
                                     <label for="screen-action" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Aksi Pemicu di Layar</label>
                                     <input type="text" id="screen-action" class="w-full form-input rounded-md" placeholder="Contoh: Jari menekan tombol 'Pesan Sekarang'">
                                 </div>
                                 <div id="unboxing-inputs" class="md:col-span-2 hidden">
                                     <label for="box-description" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Kotak Produk</label>
                                     <input type="text" id="box-description" class="w-full form-input rounded-md" placeholder="Contoh: Kotak hitam elegan dengan logo emas">
                                     <label for="unboxing-elements" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Elemen Produk yang Keluar dari Kotak</label>
                                     <textarea id="unboxing-elements" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Sepatu, rak sepatu, kaus kaki, semir sepatu"></textarea>
                                 </div>
                                 <div id="vault-inputs" class="md:col-span-2 hidden">
                                     <label for="vault-box-description" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Kotak Produk</label>
                                     <input type="text" id="vault-box-description" class="w-full form-input rounded-md" placeholder="Contoh: Kotak sepatu hitam matte dengan logo putih menyala">
                                     <label for="vault-elements" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Elemen Koleksi & Display</label>
                                     <textarea id="vault-elements" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Sepatu Air Jordan, rak display akrilik, memorabilia basket, poster, lampu LED neon"></textarea>
                                 </div>
                                <div id="pov-inputs" class="md:col-span-2 hidden">
                                     <label for="pov-action" class="block text-sm font-medium text-gray-300 mb-1">Aksi Pengguna (POV)</label>
                                     <input type="text" id="pov-action" class="w-full form-input rounded-md" placeholder="Contoh: Mengangkat iPhone ke depan mata, menekan tombol capture">
                                     <label for="pov-effect" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Efek Dramatis (Pembekuan Waktu)</label>
                                     <textarea id="pov-effect" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Waktu langsung membeku, kerumunan berhenti bergerak, tetesan hujan neon menggantung di udara"></textarea>
                                 </div>
                                 <div id="pemujaan-inputs" class="md:col-span-2 hidden">
                                     <label for="worship-figure" class="block text-sm font-medium text-gray-300 mb-1">Figur & Aksi Ritual</label>
                                     <input type="text" id="worship-figure" class="w-full form-input rounded-md" placeholder="Contoh: Sosok berjubah mendekat dengan hormat, mematahkan sepotong cokelat">
                                     <label for="worship-sound" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Suara & Musik</label>
                                     <textarea id="worship-sound" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Nyanyian Gregorian, piano ambient, bisikan 'This isn't just chocolate. It's worship.'"></textarea>
                                 </div>
                                <div id="fashion-inputs" class="md:col-span-2 hidden">
                                     <label for="fashion-character" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Karakter Utama</label>
                                     <input type="text" id="fashion-character" class="w-full form-input rounded-md" placeholder="Contoh: Seorang wanita yang percaya diri dan misterius">
                                     <label for="fashion-action" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Aksi Kunci (Memakai Produk)</label>
                                     <textarea id="fashion-action" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Memakai kacamata hitam ikonik dengan gerakan yang tajam dan percaya diri"></textarea>
                                     <label for="fashion-effect" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Efek Pembekuan Realitas</label>
                                     <textarea id="fashion-effect" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Kerumunan di sekitarnya langsung membeku, matanya memantulkan pemandangan kota futuristik melalui lensa"></textarea>
                                 </div>
                                <div id="sajian-inputs" class="md:col-span-2 hidden">
                                     <label for="plating-container" class="block text-sm font-medium text-gray-300 mb-1">Wadah Awal Produk</label>
                                     <input type="text" id="plating-container" class="w-full form-input rounded-md" placeholder="Contoh: Bungkus Indomie Mi Goreng, kotak pizza">
                                     <label for="plating-ingredients" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Bahan-bahan yang Dimasak</label>
                                     <textarea id="plating-ingredients" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: mie yang sudah matang, sayuran hijau renyah, telur mata sapi, partikel bumbu, bawang goreng"></textarea>
                                 </div>
                                <div id="teardown-inputs" class="md:col-span-2 hidden">
                                     <label for="teardown-box" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Kotak Premium</label>
                                     <input type="text" id="teardown-box" class="w-full form-input rounded-md" placeholder="Contoh: Kotak Apple Vision Pro putih bersih di atas meja kayu">
                                     <label for="teardown-components" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Komponen Inti Produk</label>
                                     <textarea id="teardown-components" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: lensa, sensor, chip, tali, dan casing"></textarea>
                                     <label for="teardown-immersion" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Efek Transisi/Imersi</label>
                                     <textarea id="teardown-immersion" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Headset bergerak ke arah penonton dan 'terpasang', layar menjadi hitam dan logo Apple muncul"></textarea>
                                 </div>
                                 <div id="kinetic-inputs" class="md:col-span-2 hidden">
                                     <label for="kinetic-subject" class="block text-sm font-medium text-gray-300 mb-1">Subjek Utama (Contoh: Pelari)</label>
                                     <input type="text" id="kinetic-subject" class="w-full form-input rounded-md" placeholder="Contoh: Seorang pelari dengan pakaian futuristik">
                                     <label for="kinetic-disintegration" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Efek Disintegrasi</label>
                                     <textarea id="kinetic-disintegration" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Tubuh pelari terurai menjadi partikel energi saat berlari cepat"></textarea>
                                     <label for="kinetic-logo" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Deskripsi Logo yang Bertransformasi</label>
                                     <input type="text" id="kinetic-logo" class="w-full form-input rounded-md" placeholder="Contoh: Logo petir yang energik">
                                 </div>
                                 <div id="absurd-inputs" class="md:col-span-2 hidden">
                                     <label for="absurd-robots" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Robot Mini</label>
                                     <input type="text" id="absurd-robots" class="w-full form-input rounded-md" placeholder="Contoh: Robot konstruksi kecil transparan non-antropomorfik">
                                     <label for="absurd-task" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Tugas yang Dibuat Rumit</label>
                                     <textarea id="absurd-task" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Membersihkan tumpahan kopi menggunakan sebuah kaus"></textarea>
                                     <label for="absurd-result" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Hasil Akhir yang Absurd (Menjadi Logo)</label>
                                     <input type="text" id="absurd-result" class="w-full form-input rounded-md" placeholder="Contoh: Mereka tidak sengaja membakar kainnya, dan bekas bakaran itu berubah menjadi logo Adidas">
                                 </div>
                                 <div id="ingredient-explosion-inputs" class="md:col-span-2 hidden">
                                     <label for="ingredient-container" class="block text-sm font-medium text-gray-300 mb-1">Wadah Bahan Baku</label>
                                     <input type="text" id="ingredient-container" class="w-full form-input rounded-md" placeholder="Contoh: Sebuah keranjang berisi cabai segar">
                                     <label for="ingredient-explosion-effect" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Efek Ledakan</label>
                                     <textarea id="ingredient-explosion-effect" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Meledak dengan api panas ke arah kamera"></textarea>
                                 </div>
                                 <div id="magical-transformation-inputs" class="md:col-span-2 hidden">
                                     <label for="magical-subject" class="block text-sm font-medium text-gray-300 mb-1">Subjek Awal Transformasi</label>
                                     <input type="text" id="magical-subject" class="w-full form-input rounded-md" placeholder="Contoh: Satu biji kopi sangrai">
                                     <label for="magical-result" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Hasil Transformasi (Beberapa Produk)</label>
                                     <textarea id="magical-result" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Es Kopi Soe Gula Merah, Regal Latte, dan Es Roegal"></textarea>
                                 </div>
                                 <div id="retro-dynamic-inputs" class="md:col-span-2 hidden">
                                     <label for="retro-character" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Karakter & Pakaian</label>
                                     <textarea id="retro-character" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Pria Indonesia percaya diri dengan kaos grafis, jeans high-waisted, dan kemeja flanel di pinggang"></textarea>
                                     <label for="retro-accessories" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Aksesori Kunci</label>
                                     <input type="text" id="retro-accessories" class="w-full form-input rounded-md" placeholder="Contoh: Kacamata putih besar, sarung tangan putih">
                                     <label for="retro-lens" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Jenis Lensa Kamera</label>
                                     <input type="text" id="retro-lens" class="w-full form-input rounded-md" placeholder="Contoh: Lensa fisheye lebar untuk perspektif dinamis">
                                 </div>
                                 <div id="harta-karun-inputs" class="md:col-span-2 hidden">
                                     <label for="treasure-container" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Wadah / Kotak Produk</label>
                                     <textarea id="treasure-container" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Koper vintage seukuran telapak tangan, kotak musik kayu tua"></textarea>
                                     <label for="treasure-reveal" class="block text-sm font-medium text-gray-300 mb-1 mt-4">Detail Aksi Pembukaan & Suara</label>
                                     <textarea id="treasure-reveal" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Kait berbunyi klik, tutup terbuka perlahan, memperlihatkan jam saku berkilauan di atas beludru"></textarea>
                                 </div>
                                <div id="location-details-wrapper" class="md:col-span-2">
                                    <label for="location-details" class="block text-sm font-medium text-gray-300 mb-1">Detail Suasana Lokasi Awal</label>
                                    <textarea id="location-details" rows="2" class="w-full form-input rounded-md" placeholder="Contoh: Papan reklame holografik, genangan air memantulkan cahaya"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Brand Identity Section -->
                        <div class="mt-6 pt-6 border-t border-gray-600">
                             <h3 class="text-xl font-semibold mb-4 text-white">Identitas Merek & Animasi Logo</h3>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                 <div class="md:col-span-2">
                                     <label for="brand-final-text" class="block text-sm font-medium text-gray-300 mb-1">Teks Akhir / Call to Action</label>
                                     <input type="text" id="brand-final-text" class="w-full form-input rounded-md" placeholder="Contoh: Shop Now, Experience the Future">
                                 </div>
                                 <div class="md:col-span-2">
                                     <label for="logo-animation-style" class="block text-sm font-medium text-gray-300 mb-1">Gaya Animasi Logo</label>
                                     <select id="logo-animation-style" class="w-full form-select rounded-md">
                                         <option value="liquid-metal">1. Liquid Metal Forming</option>
                                         <option value="crystalline-growth">2. Crystalline Growth</option>
                                         <option value="digital-glitch">3. Digital Glitch Assembly</option>
                                         <option value="particle-swarm">4. Particle Swarm Nebula</option>
                                         <option value="blueprint-reveal">5. Architectural Blueprint</option>
                                         <option value="light-streak">6. Light Streak Etching</option>
                                         <option value="percussive-assembly">7. Percussive Assembly (Hentakan)</option>
                                         <option value="glitch-morph">8. Glitch Morph (Transformasi Unik)</option>
                                         <option value="claymation-stopmotion">9. Claymation Stop-Motion (Abnormal)</option>
                                         <option value="fluid-ink-bleed">10. Fluid Ink Bleed</option>
                                         <option value="dissolve">11. Dissolve (Pudar)</option>
                                         <option value="slide">12. Slide (Geser)</option>
                                         <option value="zoom">13. Zoom (Perbesar/Perkecil)</option>
                                         <option value="wipe">14. Wipe (Sapuan)</option>
                                         <option value="glow">15. Glow (Bercahaya)</option>
                                         <option value="flash">16. Flash (Kilatan)</option>
                                         <option value="light-leaks">17. Light Leaks (Bocoran Cahaya)</option>
                                     </select>
                                 </div>
                                 <div class="md:col-span-2">
                                     <label for="brand-logo-upload" class="block text-sm font-medium text-gray-300 mb-1">Upload Logo untuk Analisis Otomatis</label>
                                     <div class="flex items-center gap-4">
                                         <input type="file" id="brand-logo-upload" accept="image/*" class="w-full form-file rounded-md file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-gray-300 hover:file:bg-gray-600">
                                         <div id="brand-logo-preview-container" class="hidden w-16 h-16 bg-gray-700 rounded-md flex items-center justify-center">
                                             <img id="brand-logo-preview" src="#" alt="Pratinjau Logo" class="max-h-full max-w-full">
                                         </div>
                                     </div>
                                 </div>
                                 <div class="md:col-span-2">
                                     <label for="logo-auto-description" class="block text-sm font-medium text-gray-300 mb-1">Deskripsi Logo (Otomatis)</label>
                                     <div class="flex items-center gap-2">
                                        <textarea id="logo-auto-description" rows="2" class="w-full form-input rounded-md bg-gray-800" placeholder="Unggah logo untuk dianalisis oleh AI..." readonly></textarea>
                                        <div id="logo-analysis-loader" class="hidden btn-loader"></div>
                                     </div>
                                 </div>
                             </div>
                        </div>

                        <div class="mt-8 text-center flex gap-4">
                            <button type="button" id="reset-button" class="btn-secondary font-bold py-3 px-8 rounded-lg text-white w-full">Reset Proyek</button>
                            <button type="submit" id="generate-button" class="btn-primary font-bold py-3 px-8 rounded-lg text-white text-lg w-full">
                                <span id="btn-text">Generate Prompts</span>
                                <span id="btn-loader" class="hidden btn-loader"></span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Output Section -->
                <div id="output-section" class="hidden mt-8 space-y-8">
                     <!-- Product Prompt Output -->
                     <div id="product-prompt-container" class="output-container p-6 rounded-xl shadow-lg">
                         <div class="flex justify-between items-center mb-4">
                             <h2 class="text-2xl font-bold text-white">1. Prompt Iklan Produk</h2>
                             <button id="copy-product-button" class="btn-secondary text-white font-semibold py-2 px-4 rounded-lg">
                                 Salin Prompt
                             </button>
                         </div>
                         <div id="generated-product-prompt" class="whitespace-pre-wrap text-gray-300 text-base leading-relaxed bg-gray-900 p-4 rounded-md"></div>
                     </div>

                     <!-- Logo Prompt Output -->
                     <div id="logo-prompt-container" class="output-container p-6 rounded-xl shadow-lg">
                         <div class="flex justify-between items-center mb-4">
                             <h2 class="text-2xl font-bold text-white">2. Prompt Animasi Logo</h2>
                             <button id="copy-logo-button" class="btn-secondary text-white font-semibold py-2 px-4 rounded-lg">
                                 Salin Prompt
                             </button>
                         </div>
                         <div id="generated-logo-prompt" class="whitespace-pre-wrap text-gray-300 text-base leading-relaxed bg-gray-900 p-4 rounded-md"></div>
                     </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden modal-overlay">
        <div class="bg-gray-800 rounded-xl shadow-lg w-full max-w-md p-6 modal-container transform scale-95">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-white">Pengaturan API Key</h2>
                <button id="close-settings-modal-button" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <div>
                <label for="api-key-input" class="block text-sm font-medium text-gray-300 mb-1">Google AI Studio API Key</label>
                <input type="password" id="api-key-input" class="w-full form-input rounded-md" placeholder="Masukkan API Key Anda...">
                <p class="text-xs text-gray-500 mt-1">API Key Anda disimpan dengan aman di browser Anda.</p>
            </div>
            <div id="api-key-message" class="text-sm mt-3"></div>
            <div class="mt-6 flex gap-4">
                <button id="save-api-key-button" class="btn-primary font-bold py-2 px-4 rounded-lg text-white w-full flex items-center justify-center">
                    <span id="save-btn-text">Simpan</span>
                    <span id="save-btn-loader" class="hidden btn-loader"></span>
                </button>
                <button id="delete-api-key-button" class="bg-red-600 hover:bg-red-700 font-bold py-2 px-4 rounded-lg text-white w-full">Hapus</button>
            </div>
        </div>
    </div>
    
    <div id="help-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden modal-overlay">
        <div class="bg-gray-800 rounded-xl shadow-lg w-full max-w-2xl p-6 modal-container transform scale-95 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 sticky top-0 bg-gray-800 py-2">
                <h2 class="text-2xl font-bold text-white">Panduan Pengguna</h2>
                <button id="close-help-modal-button" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <div id="help-modal-content" class="text-gray-300 space-y-6">
                <!-- Help content goes here -->
            </div>
        </div>
    </div>

    <div id="reset-confirm-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden modal-overlay">
        <div class="bg-gray-800 rounded-xl shadow-lg w-full max-w-md p-6 modal-container transform scale-95">
            <h2 class="text-2xl font-bold text-white">Reset Proyek?</h2>
            <p class="text-gray-400 mt-2">Apakah Anda yakin ingin membersihkan semua isian formulir dan memulai proyek baru?</p>
            <div class="mt-6 flex gap-4">
                <button id="cancel-reset-button" class="btn-secondary font-bold py-2 px-4 rounded-lg text-white w-full">Batal</button>
                <button id="confirm-reset-button" class="bg-red-600 hover:bg-red-700 font-bold py-2 px-4 rounded-lg text-white w-full">Ya, Reset</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBxHhY5THznZH0qmcrqJq8I4kTOq5m3zNc",
            authDomain: "prompt-ajaib.firebaseapp.com",
            projectId: "prompt-ajaib",
            storageBucket: "prompt-ajaib.appspot.com",
            messagingSenderId: "557430800881",
            appId: "1:557430800881:web:c651638be9f57c0810c450"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();

        // --- DOM Elements ---
        const loginContainer = document.getElementById('login-container');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const logoutButton = document.getElementById('logout-button');
        const loginBtnText = document.getElementById('login-btn-text');
        const loginBtnLoader = document.getElementById('login-btn-loader');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        
        // --- Auth State Logic ---
        onAuthStateChanged(auth, user => {
            if (user) {
                loginContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                checkApiKeyStatus();
            } else {
                loginContainer.classList.remove('hidden');
                appContainer.classList.add('hidden');
            }
        });

        // --- Login Logic ---
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;
            setLoading(true, loginForm.querySelector('button'), loginBtnText, loginBtnLoader, 'Login');
            loginError.textContent = '';
            signInWithEmailAndPassword(auth, email, password)
                .catch((error) => {
                    const errorCode = error.code;
                    let errorMessage = "Terjadi kesalahan. Silakan coba lagi.";
                    if (errorCode === 'auth/user-not-found' || errorCode === 'auth/wrong-password' || errorCode === 'auth/invalid-credential') {
                        errorMessage = "Email atau password salah.";
                    }
                    console.error("Login error:", error);
                    loginError.textContent = errorMessage;
                })
                .finally(() => {
                    setLoading(false, loginForm.querySelector('button'), loginBtnText, loginBtnLoader, 'Login');
                });
        });

        // --- Logout Logic ---
        logoutButton.addEventListener('click', () => {
            signOut(auth).then(() => {
                emailInput.value = '';
                passwordInput.value = '';
                loginError.textContent = '';
            }).catch((error) => {
                console.error("Logout error:", error);
            });
        });

        // --- App Logic ---
        let previousStyle = 'transformasi';
        const styleToFieldMap = {
            collection: { perakitan: 'product-components', ruangan: 'product-collection', ledakan: 'ledakan-collection', suasana: 'vibe-elements', unboxing: 'unboxing-elements', vault: 'vault-elements' },
            boxDescription: { unboxing: 'box-description', vault: 'vault-box-description' }
        };

        const productForm = document.getElementById('product-form');
        const outputSection = document.getElementById('output-section');
        const generatedProductPrompt = document.getElementById('generated-product-prompt');
        const generatedLogoPrompt = document.getElementById('generated-logo-prompt');
        const copyProductButton = document.getElementById('copy-product-button');
        const copyLogoButton = document.getElementById('copy-logo-button');
        const generateButton = document.getElementById('generate-button');
        const btnText = document.getElementById('btn-text');
        const btnLoader = document.getElementById('btn-loader');
        const analyzeImageButton = document.getElementById('analyze-image-button');
        const analysisResult = document.getElementById('analysis-result');
        const analyzeBtnText = document.getElementById('analyze-btn-text');
        const analyzeBtnLoader = document.getElementById('analyze-btn-loader');
        const imageUpload = document.getElementById('image-upload');
        const imagePreview = document.getElementById('image-preview');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const animationStyleSelect = document.getElementById('animation-style');
        const allStyleInputs = {
            perakitan: document.getElementById('perakitan-inputs'), logo: document.getElementById('logo-inputs'), dekonstruksi: document.getElementById('dekonstruksi-inputs'), ruangan: document.getElementById('ruangan-inputs'), ledakan: document.getElementById('ledakan-inputs'), suasana: document.getElementById('suasana-inputs'), kejutan: document.getElementById('kejutan-inputs'), layar: document.getElementById('layar-inputs'), unboxing: document.getElementById('unboxing-inputs'), vault: document.getElementById('vault-inputs'), pov: document.getElementById('pov-inputs'), pemujaan: document.getElementById('pemujaan-inputs'), fashion: document.getElementById('fashion-inputs'), sajian: document.getElementById('sajian-inputs'), teardown: document.getElementById('teardown-inputs'), kinetic: document.getElementById('kinetic-inputs'), absurd: document.getElementById('absurd-inputs'), ingredient_explosion: document.getElementById('ingredient-explosion-inputs'), magical_transformation: document.getElementById('magical-transformation-inputs'), retro_dynamic: document.getElementById('retro-dynamic-inputs'),
            'harta-karun': document.getElementById('harta-karun-inputs'),
        };
        const locationWrapper = document.getElementById('location-wrapper');
        const locationDetailsWrapper = document.getElementById('location-details-wrapper');
        const brandLogoUpload = document.getElementById('brand-logo-upload');
        const brandLogoPreview = document.getElementById('brand-logo-preview');
        const brandLogoPreviewContainer = document.getElementById('brand-logo-preview-container');
        const logoAutoDescription = document.getElementById('logo-auto-description');
        const logoAnalysisLoader = document.getElementById('logo-analysis-loader');
        const settingsModal = document.getElementById('settings-modal');
        const openSettingsButton = document.getElementById('open-settings-button');
        const openSettingsFromNotice = document.getElementById('open-settings-from-notice');
        const closeSettingsModalButton = document.getElementById('close-settings-modal-button');
        const saveApiKeyButton = document.getElementById('save-api-key-button');
        const deleteApiKeyButton = document.getElementById('delete-api-key-button');
        const apiKeyInput = document.getElementById('api-key-input');
        const apiKeyNotice = document.getElementById('api-key-notice');
        const apiKeyMessage = document.getElementById('api-key-message');
        const saveBtnText = document.getElementById('save-btn-text');
        const saveBtnLoader = document.getElementById('save-btn-loader');
        const helpModal = document.getElementById('help-modal');
        const openHelpButton = document.getElementById('open-help-button');
        const closeHelpModalButton = document.getElementById('close-help-modal-button');
        const resetConfirmModal = document.getElementById('reset-confirm-modal');
        const resetButton = document.getElementById('reset-button');
        const cancelResetButton = document.getElementById('cancel-reset-button');
        const confirmResetButton = document.getElementById('confirm-reset-button');

        let currentProductPrompt = "";

        // --- Helper: Fetch with Retry ---
        async function fetchWithRetry(url, payload, maxRetries = 3) {
            let lastError;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        return await response.json();
                    }

                    if (response.status >= 400 && response.status < 500) {
                         const errorData = await response.json();
                         const message = errorData?.error?.message || `Client error: ${response.status}`;
                         throw new Error(message);
                    }
                    
                    lastError = new Error(`Layanan AI sedang sibuk: ${response.status}`);
                    
                    const delay = Math.pow(2, i) * 1000;
                    console.log(`API call failed with status ${response.status}. Retrying in ${delay}ms...`);
                    await new Promise(resolve => setTimeout(resolve, delay));

                } catch (error) {
                    lastError = error;
                    const delay = Math.pow(2, i) * 1000;
                    console.log(`Network error during API call. Retrying in ${delay}ms...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            throw lastError;
        }


        // --- Modal Logic ---
        function toggleModal(modal, show) {
            const overlay = modal;
            const container = overlay.querySelector('.modal-container');
            if (show) {
                overlay.classList.remove('hidden');
                setTimeout(() => {
                    overlay.style.opacity = '1';
                    container.style.transform = 'scale(1)';
                }, 10);
            } else {
                overlay.style.opacity = '0';
                container.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    overlay.classList.add('hidden');
                }, 300);
            }
        }

        // --- Settings Modal ---
        async function saveApiKey() {
            const key = apiKeyInput.value.trim();
            if (!key) {
                apiKeyMessage.textContent = 'Kolom API Key tidak boleh kosong.';
                apiKeyMessage.className = 'text-sm mt-3 text-red-400';
                return;
            }
            setLoading(true, saveApiKeyButton, saveBtnText, saveBtnLoader, 'Simpan');
            apiKeyMessage.textContent = '';
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
                if (response.ok) {
                    localStorage.setItem('googleApiKey', key);
                    apiKeyMessage.textContent = 'API Key valid dan berhasil disimpan!';
                    apiKeyMessage.className = 'text-sm mt-3 text-green-400';
                    checkApiKeyStatus();
                    setTimeout(() => toggleModal(settingsModal, false), 1500);
                } else {
                    let errorMessage = 'API Key tidak valid atau terjadi masalah jaringan.';
                     try {
                         const errorData = await response.json();
                         if (errorData?.error?.message) {
                             errorMessage = `Validasi Gagal: ${errorData.error.message}`;
                         }
                     } catch (e) { /* ignore json parsing error */ }
                    throw new Error(errorMessage);
                }
            } catch (error) {
                console.error('API Key validation failed:', error);
                apiKeyMessage.textContent = error.message;
                apiKeyMessage.className = 'text-sm mt-3 text-red-400';
            } finally {
                setLoading(false, saveApiKeyButton, saveBtnText, saveBtnLoader, 'Simpan');
            }
        }

        function deleteApiKey() {
            localStorage.removeItem('googleApiKey');
            apiKeyInput.value = '';
            apiKeyMessage.textContent = 'API Key berhasil dihapus.';
            apiKeyMessage.className = 'text-sm mt-3 text-yellow-400';
            checkApiKeyStatus();
        }

        function checkApiKeyStatus() {
            const key = localStorage.getItem('googleApiKey');
            apiKeyNotice.classList.toggle('hidden', !!key);
            return !!key;
        }

        [openSettingsButton, openSettingsFromNotice].forEach(btn => btn.addEventListener('click', () => toggleModal(settingsModal, true)));
        closeSettingsModalButton.addEventListener('click', () => toggleModal(settingsModal, false));
        settingsModal.addEventListener('click', (e) => { if (e.target === settingsModal) { toggleModal(settingsModal, false); } });
        saveApiKeyButton.addEventListener('click', saveApiKey);
        deleteApiKeyButton.addEventListener('click', deleteApiKey);
        openHelpButton.addEventListener('click', () => toggleModal(helpModal, true));
        closeHelpModalButton.addEventListener('click', () => toggleModal(helpModal, false));
        helpModal.addEventListener('click', (e) => { if (e.target === helpModal) { toggleModal(helpModal, false); } });
        resetButton.addEventListener('click', () => toggleModal(resetConfirmModal, true));
        cancelResetButton.addEventListener('click', () => toggleModal(resetConfirmModal, false));
        resetConfirmModal.addEventListener('click', (e) => { if (e.target === resetConfirmModal) { toggleModal(resetConfirmModal, false); } });
        confirmResetButton.addEventListener('click', () => {
            resetForm();
            toggleModal(resetConfirmModal, false);
        });

        function resetForm() {
            productForm.reset();
            outputSection.classList.add('hidden');
            generatedProductPrompt.textContent = '';
            generatedLogoPrompt.textContent = '';
            imagePreviewContainer.classList.add('hidden');
            imagePreview.src = '#';
            brandLogoPreviewContainer.classList.add('hidden');
            brandLogoPreview.src = '#';
            analysisResult.textContent = '';
            logoAutoDescription.value = '';
            imageUpload.value = '';
            brandLogoUpload.value = '';
            animationStyleSelect.value = 'transformasi';
            handleStyleChange();
        }

        function handleStyleChange() {
            const newStyle = animationStyleSelect.value;
            const transfer = (group) => {
                const sourceId = group[previousStyle], targetId = group[newStyle];
                if (sourceId && targetId) {
                    const sourceEl = document.getElementById(sourceId), targetEl = document.getElementById(targetId);
                    if (sourceEl && targetEl && sourceEl.value && !targetEl.value) targetEl.value = sourceEl.value;
                }
            };
            transfer(styleToFieldMap.collection);
            transfer(styleToFieldMap.boxDescription);
            Object.values(allStyleInputs).forEach(el => el.classList.add('hidden'));
            if (allStyleInputs[newStyle]) allStyleInputs[newStyle].classList.remove('hidden');
            let placeholder = "Contoh: Ruangan kosong yang nyaman";
            if (newStyle === 'logo') {
                placeholder = "Contoh: Ruang putih minimalis berkabut";
                locationDetailsWrapper.classList.add('hidden');
            } else if (newStyle === 'transformasi' || newStyle === 'fashion') {
                placeholder = "Contoh: Jalanan kota yang ramai saat senja";
            }
            document.getElementById('location').placeholder = placeholder;
            previousStyle = newStyle;
        }
        animationStyleSelect.addEventListener('change', handleStyleChange);

        const handleFileUpload = (event, previewEl, containerEl) => {
            if (event.target.files && event.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewEl.src = e.target.result;
                    containerEl.classList.remove('hidden');
                };
                reader.readAsDataURL(event.target.files[0]);
            }
        };
        imageUpload.addEventListener('change', (e) => handleFileUpload(e, imagePreview, imagePreviewContainer));
        
        brandLogoUpload.addEventListener('change', (e) => {
            handleFileUpload(e, brandLogoPreview, brandLogoPreviewContainer);
            analyzeLogo(e.target.files[0]);
        });
        
        async function analyzeLogo(file) {
            if (!file) return;
            if (!checkApiKeyStatus()) {
                toggleModal(settingsModal, true);
                return;
            }
            logoAnalysisLoader.classList.remove('hidden');
            logoAutoDescription.value = '';
            logoAutoDescription.placeholder = 'Menganalisis logo dengan AI...';

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onloadend = async () => {
                const base64ImageData = reader.result.split(',')[1];
                try {
                    const prompt = "Analyze this logo image and provide a concise, detailed, and objective description of its visual elements in one short sentence. For example: 'the Adidas trefoil logo, which consists of three leaf shapes with three horizontal stripes across them' or 'the Apple logo, an apple with a bite taken out of it'.";
                    const payload = { contents: [{ parts: [{ text: prompt }, { inlineData: { mimeType: file.type, data: base64ImageData } }] }] };
                    const apiKey = localStorage.getItem('googleApiKey');
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
                    
                    const result = await fetchWithRetry(apiUrl, payload);

                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        logoAutoDescription.value = result.candidates[0].content.parts[0].text.trim();
                    } else { throw new Error("Invalid response from AI."); }
                } catch (error) {
                    console.error('Error analyzing logo:', error);
                    logoAutoDescription.placeholder = `Gagal menganalisis: ${error.message}. Coba lagi.`;
                } finally {
                    logoAnalysisLoader.classList.add('hidden');
                }
            };
        }

        analyzeImageButton.addEventListener('click', async () => {
            if (!checkApiKeyStatus()) return toggleModal(settingsModal, true);
            const file = imageUpload.files[0];
            if (!file) {
                analysisResult.textContent = 'Mohon pilih gambar untuk dianalisis.';
                analysisResult.className = 'text-yellow-400 mt-3 text-center font-semibold';
                return;
            }
            setLoading(true, analyzeImageButton, analyzeBtnText, analyzeBtnLoader, 'Analisa Gambar');
            analysisResult.textContent = '';
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onloadend = async () => {
                const base64ImageData = reader.result.split(',')[1];
                try {
                    const prompt = `You are a creative director expert. Analyze the image. Generate a JSON object for a video ad concept with keys: "product_name", "product_features", "location", "location_details", "key_elements", and "recommended_style". The style must be one of: 'transformasi', 'perakitan', 'logo', 'dekonstruksi', 'ruangan', 'ledakan', 'suasana', 'kejutan', 'layar', 'unboxing', 'vault', 'pov', 'pemujaan', 'fashion', 'sajian', 'teardown', 'kinetic', 'absurd', 'ingredient_explosion', 'magical_transformation', 'retro_dynamic'.`;
                    const payload = { contents: [{ parts: [{ text: prompt }, { inlineData: { mimeType: file.type, data: base64ImageData } }] }], generationConfig: { responseMimeType: "application/json" } };
                    const apiKey = localStorage.getItem('googleApiKey');
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
                    
                    const result = await fetchWithRetry(apiUrl, payload);

                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        const analysis = JSON.parse(result.candidates[0].content.parts[0].text);
                        document.getElementById('product-name').value = analysis.product_name || '';
                        document.getElementById('product-features').value = analysis.product_features || '';
                        document.getElementById('location').value = analysis.location || '';
                        document.getElementById('location-details').value = analysis.location_details || '';
                        animationStyleSelect.value = analysis.recommended_style;
                        handleStyleChange();
                        const selectedOptionText = animationStyleSelect.options[animationStyleSelect.selectedIndex].text;
                        analysisResult.textContent = `Analisis Selesai! Gaya direkomendasikan: ${selectedOptionText}. Formulir telah diisi.`;
                        analysisResult.className = 'text-green-400 mt-3 text-center font-semibold';
                    } else { throw new Error("Invalid response from AI."); }
                } catch (error) {
                    console.error('Error analyzing image:', error);
                    analysisResult.textContent = `Maaf, gagal menganalisis gambar: ${error.message}. Coba lagi.`;
                    analysisResult.className = 'text-red-400 mt-3 text-center font-semibold';
                } finally {
                    setLoading(false, analyzeImageButton, analyzeBtnText, analyzeBtnLoader, 'Analisa Gambar');
                }
            };
        });

        productForm.addEventListener('submit', (e) => {
            e.preventDefault();
            setLoading(true, generateButton, btnText, btnLoader, 'Generate Prompts');
            const getVal = id => document.getElementById(id).value;
            const userInput = {
                style: getVal('animation-style'),
                aspectRatio: document.querySelector('input[name="aspect_ratio"]:checked').value,
                productName: getVal('product-name'), productFeatures: getVal('product-features'), location: getVal('location'), locationDetails: getVal('location-details'), productComponents: getVal('product-components'), logoDescription: getVal('logo-description'), finalElement: getVal('final-element'), dekonLogoText: getVal('dekon-logo-text'), dekonComponents: getVal('dekon-components'), productCollection: getVal('product-collection'), finalHumanElement: getVal('final-human-element'), ledakanCollection: getVal('ledakan-collection'), humanReaction: getVal('human-reaction'), vibeDescription: getVal('vibe-description'), vibeElements: getVal('vibe-elements'), surpriseRecipient: getVal('surprise-recipient'), surpriseElement: getVal('surprise-element'), screenProduct: getVal('screen-product'), screenAction: getVal('screen-action'), boxDescription: getVal('box-description'), unboxingElements: getVal('unboxing-elements'), vaultBoxDescription: getVal('vault-box-description'), vaultElements: getVal('vault-elements'), povAction: getVal('pov-action'), povEffect: getVal('pov-effect'), worshipFigure: getVal('worship-figure'), worshipSound: getVal('worship-sound'), fashionCharacter: getVal('fashion-character'), fashionAction: getVal('fashion-action'), fashionEffect: getVal('fashion-effect'), platingContainer: getVal('plating-container'), platingIngredients: getVal('plating-ingredients'), teardownBox: getVal('teardown-box'), teardownComponents: getVal('teardown-components'), teardownImmersion: getVal('teardown-immersion'), kineticSubject: getVal('kinetic-subject'), kineticDisintegration: getVal('kinetic-disintegration'), kineticLogo: getVal('kinetic-logo'), absurdRobots: getVal('absurd-robots'), absurdTask: getVal('absurd-task'), absurdResult: getVal('absurd-result'), ingredientContainer: getVal('ingredient-container'), ingredientExplosionEffect: getVal('ingredient-explosion-effect'), magicalSubject: getVal('magical-subject'), magicalResult: getVal('magical-result'), retroCharacter: getVal('retro-character'), retroAccessories: getVal('retro-accessories'), retroLens: getVal('retro-lens'),
                brandFinalText: getVal('brand-final-text'),
                logoAnimationStyle: getVal('logo-animation-style'),
                logoAutoDescription: getVal('logo-auto-description'),
                treasureContainer: getVal('treasure-container'),
                treasureReveal: getVal('treasure-reveal'),
            };
            try {
                currentProductPrompt = generateProductPrompt(userInput);
                const logoPrompt = generateLogoPrompt(userInput);
                generatedProductPrompt.textContent = currentProductPrompt;
                generatedLogoPrompt.textContent = logoPrompt;
                outputSection.classList.remove('hidden');
                outputSection.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error("Error generating prompts:", error);
                generatedProductPrompt.textContent = "Maaf, terjadi kesalahan. Silakan coba lagi.";
                generatedLogoPrompt.textContent = "";
            } finally {
                setLoading(false, generateButton, btnText, btnLoader, 'Generate Prompts');
            }
        });

        function setLoading(isLoading, button, textEl, loaderEl, defaultText) {
            button.disabled = isLoading;
            textEl.textContent = defaultText;
            textEl.classList.toggle('hidden', isLoading);
            loaderEl.classList.toggle('hidden', !isLoading);
        }

        function generateProductPrompt(data) {
            let base = `cinematic video, 60fps, aspect ratio ${data.aspectRatio}, 8k, photorealistic, high detail, professional color grading,`;
            let prompt = '';
            switch (data.style) {
                case 'transformasi': prompt = `${base} dynamic shot in a bustling ${data.location}, a person throws a small high-tech capsule, it lands and with a 'POOF' of thick smoke, it instantly transforms into a new ${data.productName} which has these features: ${data.productFeatures}. Onlookers are stunned and amazed.`; break;
                case 'perakitan': prompt = `${base} fixed wide angle shot in a premium ${data.location}, ${data.productComponents} fly out and assemble in slow-motion, merging precisely to form a perfect ${data.productName} with features like ${data.productFeatures}.`; break;
                case 'logo': prompt = `${base} in a minimalist abstract space, a glowing ${data.logoDescription} logo morphs and twists like ribbons of energy, then explodes into fragments that swirl and reassemble mid-air into a ${data.productName}. The camera floats around them in slow motion as they land. ${data.finalElement ? `${data.finalElement} rolls in and stops perfectly next to the product.` : ''}`; break;
                case 'dekonstruksi': prompt = `${base} ultra macro shot of a ${data.dekonLogoText} in a dark, luxurious space. It deconstructs into its mechanical components: ${data.dekonComponents}. The parts float and rearrange themselves into a perfect ${data.productName}.`; break;
                case 'ruangan': prompt = `${base} fixed wide-angle view of an empty ${data.location}, a flat-pack box with the ${data.productName} logo opens, and a full room of furniture (${data.productCollection}) assembles itself rapidly in a time-lapse style. ${data.finalHumanElement ? `Finally, ${data.finalHumanElement} pops out from the box, gesturing enthusiastically at the newly assembled room.` : ''}`; break;
                case 'ledakan': prompt = `${base} slow camera push-in on a large box labeled '${data.productName}' in an empty, cozy ${data.location}. The box suddenly bursts open, and a vibrant, colorful living room (${data.ledakanCollection}) erupts in slow motion. When everything is in place, ${data.humanReaction} appears in the middle of the scene, with an expressive shocked pose.`; break;
                case 'suasana': prompt = `${base} in an empty room with sunlight streaming in, a box labeled '${data.productName}' opens and a complete, cozy ${data.vibeDescription} scene bursts out in slow motion, including ${data.vibeElements}. The view outside the window transforms to match the new cozy, bohemian mood.`; break;
                case 'kejutan': prompt = `${base} in a beautiful, cozy ${data.location}, ${data.surpriseRecipient} looks surprised as a gift box labeled '${data.productName}' opens slowly. From inside, ${data.surpriseElement} emerges in dramatic slow motion, illuminated by soft golden light, creating a subtle romantic atmosphere with floating dust particles.`; break;
                case 'layar': prompt = `${base} 3D animation scene in a cozy ${data.location}, a realistic hand holds a smartphone showing a ${data.screenProduct}. The hand performs an action: ${data.screenAction}. The ${data.productName} then emerges out of the phone, floating with smooth realistic animation, and lands perfectly on the table, becoming a real aesthetic object with detailed textures.`; break;
                case 'unboxing': prompt = `${base} in a clean, modern ${data.location}, a stylish box described as '${data.boxDescription}' sits at the center. The camera quickly zooms toward the box. The box opens smoothly with a subtle glow from inside. From the open box, product-related elements like ${data.unboxingElements} begin to float upward with gentle motion and soft lighting. The elements hover momentarily, then spread out and arrange themselves neatly around the box. Finally, the camera pulls back slowly to reveal the full, elegant setup.`; break;
                case 'vault': prompt = `${base} photorealistic cinematic shot of an empty modern ${data.location} with ${data.locationDetails}. A sealed ${data.vaultBoxDescription} sits in the center. The box shakes intensely, glows with red accent lighting, and bursts open dramatically. ${data.vaultElements} fly out and assemble rapidly into a complete luxury collector's vault. The final shot is a bold, high-energy sanctuary glowing with cool LED lighting and red neon accents.`; break;
                case 'pov': prompt = `${base} dynamic first-person POV, user runs through a hyper-modern, neon-lit ${data.location} at night. Heartbeat synced with techno pulses. Holographic signs and data streams glitch and react to eye movement. In one motion, user performs action: ${data.povAction}. Instantly, ${data.povEffect}. The camera orbits 360 degrees, capturing the surreal stillness of the scene. The main product, ${data.productName}, is then revealed in a macro close-up, looking high-gloss and futuristic.`; break;
                case 'pemujaan': prompt = `${base} sweeping cinematic crane shot descending into a vast, candle-lit ${data.location} with ${data.locationDetails}. In the center, a glowing pedestal rises, with a perfect ${data.productName} resting atop it, glistening. ${data.worshipFigure}. The camera glides around the product in ultra-close macro, catching soft gold reflections. Sound of ${data.worshipSound}.`; break;
                case 'fashion': prompt = `${base} cinematic slow-motion close-up shot, POV from a passing stranger as ${data.fashionCharacter} stands still in a bustling ${data.location} at golden hour, glowing halo of sun behind their head. Camera slowly tracks as they perform the action: ${data.fashionAction}. Suddenly, the bustling crowd around them freezes, motionless, as they turn their head and lock eyes with the camera. ${data.fashionEffect}. As they walk past the camera, the world resumes normal speed. Style: high fashion, modern noir, luxurious, mysterious, bold.`; break;
                case 'sajian': prompt = `${base} hyper-realistic cinematic food sequence in a ${data.location} with ${data.locationDetails}. A sealed ${data.platingContainer} is placed on a table under focused top-light. The container opens smoothly, releasing individual cooked ingredients into the air: ${data.platingIngredients}. Each component rises gracefully in a seamless, elegant slow-floating motion with no blur. The camera follows this orchestrated assembly as ingredients land precisely onto a clean plate. The final frame reveals a neatly plated ${data.productName} dish. Mood is elegant, focused, mouth-watering.`; break;
                case 'teardown': prompt = `${base} in a softly lit, premium environment like a ${data.location}, a pristine ${data.teardownBox} rests on a surface. The camera slowly pushes in as the box gently opens on its own. The ${data.productName} lifts smoothly and floats mid-air, rotating to show its details. The device then disassembles into its core components — ${data.teardownComponents} — all suspended in precise formation. The camera floats through the exploded view, highlighting craftsmanship, before the components magnetically reassemble. Finally, ${data.teardownImmersion}. Style: Apple-level premium, tactile, futuristic, luxurious.`; break;
                case 'kinetic': prompt = `${base} starts with a wide anamorphic landscape shot of a ${data.kineticSubject} in the center of ${data.location}. As they run, the camera transitions to a low-angle ground-level tracking of their feet. Suddenly, ${data.kineticDisintegration}. A lateral camera sweep follows the particles, which then converge into a high-angle reveal of the ${data.kineticLogo}. The logo morphs smoothly into the final ${data.productName}, with the camera pulling back to a clean product shot. Mood is energetic, high-tech, and powerful.`; break;
                case 'absurd': prompt = `${base} a group of tiny, ${data.absurdRobots} are trying to perform a simple task: ${data.absurdTask}. They do it in an overly complicated and absurd way, with tiny mechanisms and chaotic energy. In the end, they fail at the task but accidentally create something amazing: ${data.absurdResult}. The final shot is a macro close-up of this accidental creation. Mood is humorous, quirky, and surprising.`; break;
                case 'ingredient_explosion': prompt = `${base} VFX advertisement in a ${data.location} with ${data.locationDetails}. A ${data.ingredientContainer} ${data.ingredientExplosionEffect}, revealing the ${data.productName}. Cinematic background music and sound effects enhance the dramatic reveal.`; break;
                case 'magical_transformation': prompt = `${base} a single ${data.magicalSubject} magically transforms into various signature drinks: ${data.magicalResult}. As it transforms, a ${data.location} with ${data.locationDetails} instantly assembles around it. The scene has nostalgic warm tones. Fixed wide-angle shot with subtle zooms on the transformation. Mood is cinematic, magical, and vibrant.`; break;
                case 'retro_dynamic': prompt = `${base} a playful and retro-inspired scene in a ${data.location} with ${data.locationDetails}. Featuring ${data.retroCharacter} wearing ${data.productName} and ${data.retroAccessories}. The shot is taken with a ${data.retroLens}, creating an exaggerated, dynamic perspective. The lighting is soft yet vibrant. Mood is nostalgic, energetic, and carefree.`; break;
                case 'harta-karun': prompt = `${base} macro, ultra-realistic stationary shot on a ${data.location} with ${data.locationDetails}. A ${data.treasureContainer} sits center. ${data.treasureReveal}. The camera focuses on the hyper-detailed craftsmanship of the ${data.productName}, highlighting its features: ${data.productFeatures}.`; break;
            }
            return prompt;
        }

        function generateLogoPrompt(data) {
            const logoDescription = data.logoAutoDescription || "the brand's logo";
            let base = `logo reveal animation, 3D render, 8K, ultra-realistic, cinematic lighting, dramatic, high-end, aspect ratio ${data.aspectRatio},`;
            let prompt = '';
            switch(data.logoAnimationStyle) {
                case 'liquid-metal': prompt = `${base} drops of liquid chrome/gold coalesce on a dark, reflective surface, swirling and merging to form ${logoDescription} with intricate surface ripples.`; break;
                case 'crystalline-growth': prompt = `${base} macro shot of complex crystal structures growing and branching out rapidly, forming the facets of ${logoDescription}. Light refracts beautifully through the crystalline form.`; break;
                case 'digital-glitch': prompt = `${base} on a black background, digital artifacts, scan lines, and glitched pixels rapidly assemble and de-noise, snapping into place to reveal a sharp, clean ${logoDescription}.`; break;
                case 'particle-swarm': prompt = `${base} thousands of glowing particles, like a nebula or a swarm of fireflies, swirl in a vortex before elegantly converging to form the solid shape of ${logoDescription}.`; break;
                case 'blueprint-reveal': prompt = `${base} a holographic blueprint of ${logoDescription} is drawn in the air with lines of light. The lines then fill in with solid, premium materials (like brushed metal or carbon fiber) to complete the logo.`; break;
                case 'light-streak': prompt = `${base} streaks of colored light race across the screen from multiple directions, carving and etching ${logoDescription} into a dark stone or metal surface, leaving glowing trails.`; break;
                case 'percussive-assembly': prompt = `${base} in a dark, industrial space, components of ${logoDescription} slam into place one by one from off-screen, each impact creating a visible shockwave and a deep bass sound. The final piece locks in, completing the logo with a powerful thud.`; break;
                case 'glitch-morph': prompt = `${base} a chaotic mess of digital noise, datamoshing, and RGB split effects flicker on screen. The glitches start to resolve and coalesce, morphing and stabilizing into the clean, sharp ${logoDescription}.`; break;
                case 'claymation-stopmotion': prompt = `${base} a stop-motion animation where different colored lumps of clay are sculpted frame-by-frame on a textured surface, finally forming the complete ${logoDescription}. The lighting is soft and tactile, showing fingerprints on the clay.`; break;
                case 'fluid-ink-bleed': prompt = `${base} a macro shot of a drop of black ink falling onto a wet, textured paper surface. The ink bleeds outwards in beautiful, organic patterns, magically forming the precise shape of ${logoDescription}.`; break;
                case 'dissolve': prompt = `${base} on a clean background, ${logoDescription} slowly materializes, dissolving into view with soft, ethereal particles, creating a gentle and elegant reveal.`; break;
                case 'slide': prompt = `${base} ${logoDescription} slides smoothly and quickly into the center of the frame from off-screen, with a subtle motion blur effect to emphasize its dynamic entrance.`; break;
                case 'zoom': prompt = `${base} the camera starts on a black screen and rapidly zooms back to dramatically reveal ${logoDescription} at the center, creating a powerful and impactful entrance.`; break;
                case 'wipe': prompt = `${base} a clean, sharp line wipes across the screen, progressively revealing ${logoDescription} as it passes, creating a clean and modern transition.`; break;
                case 'glow': prompt = `${base} ${logoDescription} materializes from a soft, elegant glow of light, with volumetric rays emanating from behind it, creating a futuristic and premium feel.`; break;
                case 'flash': prompt = `${base} a powerful flash of bright, lens-flare-inducing light explodes on screen, quickly receding to reveal ${logoDescription} in its place, looking sharp and impactful.`; break;
                case 'light-leaks': prompt = `${base} vintage and artistic, ${logoDescription} is revealed through warm, analogue light leaks that wash over the screen, giving it a retro and dreamy quality.`; break;
            }
            if (data.brandFinalText) {
                prompt += ` The text "${data.brandFinalText}" appears elegantly below the fully formed logo.`;
            }
            return prompt;
        }
        
        const copyToClipboard = (text, button) => {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.opacity = "0";
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                button.textContent = 'Berhasil Disalin!';
                setTimeout(() => { button.textContent = 'Salin Prompt'; }, 2000);
            } catch (err) {
                console.error('Gagal menyalin:', err);
            }
            document.body.removeChild(textArea);
        };
        copyProductButton.addEventListener('click', () => copyToClipboard(generatedProductPrompt.textContent, copyProductButton));
        copyLogoButton.addEventListener('click', () => copyToClipboard(generatedLogoPrompt.textContent, copyLogoButton));

        document.addEventListener('DOMContentLoaded', () => {
            [settingsModal, helpModal, resetConfirmModal].forEach(modal => {
                modal.style.opacity = '0';
                modal.querySelector('.modal-container').style.transform = 'scale(0.95)';
            });
            checkApiKeyStatus();
            handleStyleChange();
            document.getElementById('help-modal-content').innerHTML = `
                <section>
                    <h3 class="text-xl font-semibold text-white mb-2">1. Cara Mendapatkan Google AI Studio API Key</h3>
                    <p>API Key ini wajib diisi agar fitur AI (Analisa Gambar) bisa berfungsi. Caranya mudah:</p>
                    <ol class="mt-2 space-y-1">
                        <li>Buka situs <a href="https://aistudio.google.com/" target="_blank" class="text-blue-400 hover:underline">Google AI Studio</a>.</li>
                        <li>Masuk dengan akun Google Anda, lalu klik <strong class="text-white">"Get API Key"</strong> &gt; <strong class="text-white">"Create API key in new project"</strong>.</li>
                        <li>Salin (copy) kunci yang muncul.</li>
                        <li>Kembali ke aplikasi ini, buka <strong class="text-white">Pengaturan</strong> (ikon gerigi), tempel (paste) kuncinya, lalu klik <strong class="text-white">Simpan</strong>.</li>
                    </ol>
                </section>
                <section>
                    <h3 class="text-xl font-semibold text-white mb-2">2. Cara Penggunaan (Dengan Analisis Logo Otomatis)</h3>
                    <p>Aplikasi ini sekarang bisa menganalisis logo Anda secara otomatis untuk prompt yang lebih akurat.</p>
                    <ol>
                        <li><strong class="text-white">(Opsional) Analisa Produk:</strong> Unggah gambar produk dan klik "Analisa Gambar" untuk mengisi formulir produk.</li>
                        <li><strong class="text-white">Lengkapi Formulir Produk:</strong> Isi atau sesuaikan detail produk dan pilih gaya iklan.</li>
                        <li><strong class="text-white">Analisa Logo:</strong> Di bagian bawah, unggah file gambar logo Anda. AI akan otomatis menganalisis dan mengisi kolom "Deskripsi Logo".</li>
                        <li><strong class="text-white">Atur Teks Akhir:</strong> Isi Teks Akhir/Call to Action dan pilih gaya animasi logo.</li>
                        <li><strong class="text-white">Generate:</strong> Klik "Generate Prompts" untuk mendapatkan kedua hasil prompt.</li>
                    </ol>
                </section>
                 <section>
                    <h3 class="text-xl font-semibold text-white mb-2">3. Penjelasan Gaya Animasi Logo</h3>
                    <p>Berikut adalah beberapa gaya baru yang telah ditambahkan:</p>
                    <ul class="list-disc list-inside mt-2 space-y-2">
                        <li><strong class="text-blue-300">Percussive Assembly:</strong> Komponen logo muncul satu per satu dengan hentakan yang kuat dan efek suara bass.</li>
                        <li><strong class="text-blue-300">Glitch Morph:</strong> Logo terbentuk dari kumpulan efek distorsi digital (glitch) yang kemudian menjadi stabil.</li>
                        <li><strong class="text-blue-300">Claymation Stop-Motion:</strong> Gaya unik di mana logo tampak seperti dibentuk dari tanah liat frame-by-frame.</li>
                        <li><strong class="text-blue-300">Dissolve, Slide, Zoom, Wipe:</strong> Efek transisi klasik untuk memunculkan atau menghilangkan logo dengan cara yang dinamis dan bersih.</li>
                        <li><strong class="text-blue-300">Glow, Flash, Light Leaks:</strong> Berbagai efek cahaya untuk memberikan nuansa futuristik, dramatis, atau retro pada logo Anda.</li>
                    </ul>
                </section>
            `;
        });
    </script>
</body>
</html>
